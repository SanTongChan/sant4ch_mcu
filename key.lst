C51 COMPILER V9.01   KEY                                                                   07/17/2017 20:56:10 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN key.obj
COMPILER INVOKED BY: F:\Program Files\Keil\C51\BIN\C51.EXE code\key\key.c BROWSE INCDIR(.\code\key;.\code\logic;.\code\t
                    -imer;.\code\driver;.\code\led;.\code\common;.\code\flash;.\code\remote) DEBUG OBJECTEXTEND PRINT(.\key.lst) OBJECT(key.o
                    -bj)

line level    source

   1          #include "key.h"
   2          #include "key_driver.h"
   3          #include "led.h"
   4          #include "logic.h"
   5          #include "remote.h"
   6          
   7          sbit KEY1 = P1^3;
   8          sbit KEY2 = P1^2;
   9          sbit KEY3 = P1^1;
  10          sbit KEY4 = P1^0;
  11          sbit KEY5 = P1^4;
  12          uint8_t h595_val = 0x0f;
  13          
  14          static bool key1_is_press(void)
  15          {
  16   1          if(0 == KEY1)
  17   1          {
  18   2              return true;
  19   2          }
  20   1          return false;
  21   1      }
  22          static bool key2_is_press(void)
  23          {
  24   1          if(0 == KEY2)
  25   1          {
  26   2              return true;
  27   2          }
  28   1          return false;
  29   1      }
  30          static bool key3_is_press(void)
  31          {
  32   1          if(0 == KEY3)
  33   1          {
  34   2              return true;
  35   2          }
  36   1          return false;
  37   1      }
  38          static bool key4_is_press(void)
  39          {
  40   1          if(0 == KEY4)
  41   1          {
  42   2              return true;
  43   2          }
  44   1          return false;
  45   1      }
  46          static bool key5_is_press(void)
  47          {
  48   1          if(0 == KEY5)
  49   1          {
  50   2              return true;
  51   2          }
  52   1          return false;
  53   1      }
C51 COMPILER V9.01   KEY                                                                   07/17/2017 20:56:10 PAGE 2   

  54          
  55          static void key1_short_press(void)
  56          {
  57   1          if(dev_def.remote)
  58   1          {
  59   2              clearIrData();
  60   2              RF_LED = 1;
  61   2              dev_def.remote_channel = 1;
  62   2          }
  63   1          else
  64   1          {
  65   2              if(h595_val | KEY1_595)
  66   2              {
  67   3                  h595_val = h595_val & (~KEY1_595);
  68   3                  SendTo595(h595_val);
  69   3              }
  70   2          }
  71   1      }
  72          static void key2_short_press(void)
  73          {
  74   1          if(dev_def.remote)
  75   1          {
  76   2              clearIrData();
  77   2              RF_LED = 1;
  78   2              dev_def.remote_channel = 2;
  79   2          }
  80   1          else
  81   1          {
  82   2              if(h595_val | KEY2_595)
  83   2              {
  84   3                  h595_val = h595_val & (~KEY2_595);
  85   3                      SendTo595(h595_val);    
  86   3              }
  87   2              }
  88   1      }
  89          static void key3_short_press(void)
  90          {   
  91   1          if(dev_def.remote)
  92   1          {
  93   2              clearIrData();
  94   2              RF_LED = 1;
  95   2              dev_def.remote_channel = 3;
  96   2          }
  97   1          else
  98   1          {
  99   2              if(h595_val | KEY3_595)
 100   2              {
 101   3                      h595_val = h595_val & (~KEY3_595);
 102   3                      SendTo595(h595_val);
 103   3              }
 104   2              }
 105   1      }
 106          static void key4_short_press(void)
 107          {
 108   1          if(dev_def.remote)
 109   1          {
 110   2              clearIrData();
 111   2              RF_LED = 1;
 112   2              dev_def.remote_channel = 4;
 113   2          }
 114   1          else
 115   1          {
C51 COMPILER V9.01   KEY                                                                   07/17/2017 20:56:10 PAGE 3   

 116   2              if(h595_val | KEY4_595)
 117   2              {
 118   3                      h595_val = h595_val & (~KEY4_595);
 119   3                      SendTo595(h595_val);
 120   3              }
 121   2              }
 122   1      }
 123          static void key5_short_up_press(void)
 124          {
 125   1          if(dev_def.remote)
 126   1          {
 127   2              dev_def.remote = false;
 128   2              dev_def.remote_channel = 0;
 129   2              RF_LED = 0;
 130   2          }
 131   1      }
 132          
 133          static void key1_short_up_press(void)
 134          {
 135   1          if(!dev_def.remote)
 136   1          {
 137   2              if(RELAY1)
 138   2              {
 139   3                  h595_val &= (~RELAY1_595);
 140   3              }
 141   2              else
 142   2              {
 143   3                  if(dev_def.lock)
 144   3                  {
 145   4                      h595_val &= 0x0f;
 146   4                  }
 147   3                  h595_val |= RELAY1_595;
 148   3              }
 149   2              h595_val |= KEY1_595;
 150   2              SendTo595(h595_val);
 151   2              if(dev_def.setting == true)
 152   2              {
 153   3                  dev_def.setting = false;
 154   3                  update_time = 10;
 155   3              }
 156   2              else
 157   2              {
 158   3                  update_time = 5;
 159   3              }
 160   2              dev_def.dev_channel[0].update_flag = true;
 161   2              dev_def.dev_channel[1].update_flag = true;
 162   2              dev_def.dev_channel[2].update_flag = true;
 163   2              dev_def.dev_channel[3].update_flag = true;
 164   2              dev_def.update_local_cnt = 0;
 165   2          }
 166   1          else
 167   1          {
 168   2              RF_LED = 0;
 169   2          }
 170   1      }
 171          static void key2_short_up_press(void)
 172          {
 173   1          if(!dev_def.remote)
 174   1          {
 175   2              if(RELAY2)
 176   2              {
 177   3                  h595_val &= (~RELAY2_595);
C51 COMPILER V9.01   KEY                                                                   07/17/2017 20:56:10 PAGE 4   

 178   3              }
 179   2              else
 180   2              {
 181   3                  if(dev_def.lock)
 182   3                  {
 183   4                      h595_val &= 0x0f;
 184   4                  }
 185   3                  h595_val |= RELAY2_595; 
 186   3              }
 187   2              h595_val |= KEY2_595;
 188   2              SendTo595(h595_val);
 189   2              if(dev_def.setting == true)
 190   2              {
 191   3                  dev_def.setting = false;
 192   3                  update_time = 10;
 193   3              }
 194   2              else
 195   2              {
 196   3                  update_time = 5;
 197   3              }
 198   2              dev_def.dev_channel[0].update_flag = true;
 199   2              dev_def.dev_channel[1].update_flag = true;
 200   2              dev_def.dev_channel[2].update_flag = true;
 201   2              dev_def.dev_channel[3].update_flag = true;
 202   2              dev_def.update_local_cnt = 0;
 203   2          }
 204   1          else
 205   1          {
 206   2              RF_LED = 0;
 207   2          }
 208   1      }
 209          static void key3_short_up_press(void)
 210          {
 211   1          if(!dev_def.remote)
 212   1          {
 213   2              if(RELAY3)
 214   2              {
 215   3                  h595_val &= (~RELAY3_595);
 216   3              }
 217   2              else
 218   2              {
 219   3                  if(dev_def.lock)
 220   3                  {
 221   4                      h595_val &= 0x0f;
 222   4                  }
 223   3                  h595_val |= RELAY3_595;
 224   3                  
 225   3              }
 226   2              h595_val |= KEY3_595;
 227   2              SendTo595(h595_val);
 228   2              if(dev_def.setting == true)
 229   2              {
 230   3                  dev_def.setting = false;
 231   3                  update_time = 10;
 232   3              }
 233   2              else
 234   2              {
 235   3                  update_time = 5;
 236   3              }
 237   2              dev_def.dev_channel[0].update_flag = true;
 238   2              dev_def.dev_channel[1].update_flag = true;
 239   2              dev_def.dev_channel[2].update_flag = true;
C51 COMPILER V9.01   KEY                                                                   07/17/2017 20:56:10 PAGE 5   

 240   2              dev_def.dev_channel[3].update_flag = true;
 241   2              dev_def.update_local_cnt = 0;
 242   2          }
 243   1          else
 244   1          {
 245   2              RF_LED = 0;
 246   2          }
 247   1      }
 248          static void key4_short_up_press(void)
 249          {
 250   1          if(!dev_def.remote)
 251   1          {
 252   2              if(RELAY4)
 253   2              {
 254   3                  h595_val &= (~RELAY4_595);
 255   3                  
 256   3              }
 257   2              else
 258   2              {
 259   3                  if(dev_def.lock)
 260   3                  {
 261   4                      h595_val &= 0x0f;
 262   4                  }
 263   3                  h595_val |= RELAY4_595;
 264   3              }
 265   2              h595_val |= KEY4_595;
 266   2              SendTo595(h595_val);
 267   2              if(dev_def.setting == true)
 268   2              {
 269   3                  dev_def.setting = false;
 270   3                  update_time = 10;
 271   3              }
 272   2              else
 273   2              {
 274   3                  update_time = 5;
 275   3              }
 276   2              dev_def.dev_channel[0].update_flag = true;
 277   2              dev_def.dev_channel[1].update_flag = true;
 278   2              dev_def.dev_channel[2].update_flag = true;
 279   2              dev_def.dev_channel[3].update_flag = true;
 280   2              dev_def.update_local_cnt = 0;
 281   2          }
 282   1          else
 283   1          {
 284   2              RF_LED = 0;
 285   2          }
 286   1      }
 287          static void key5_long_press(void)
 288          {
 289   1          if(dev_def.remote)
 290   1          {
 291   2              dev_def.remote = false;
 292   2              dev_def.remote_channel = 0;
 293   2              RF_LED = 0;
 294   2          }
 295   1          else
 296   1          {
 297   2              dev_def.remote = true;
 298   2              dev_def.remote_channel = 0;
 299   2              RF_LED = 0;
 300   2          }
 301   1      }
C51 COMPILER V9.01   KEY                                                                   07/17/2017 20:56:10 PAGE 6   

 302          static void key1_long_press(void)
 303          {
 304   1          if(dev_def.remote)
 305   1          {
 306   2              dev_def.dev_channel[0].remote_val = 0;
 307   2              RF_LED = 0;
 308   2          }
 309   1      }
 310          static void key2_long_press(void)
 311          {
 312   1          if(dev_def.remote)
 313   1          {
 314   2              dev_def.dev_channel[1].remote_val = 0;
 315   2              RF_LED = 0;
 316   2          }
 317   1      }
 318          static void key3_long_press(void)
 319          {
 320   1          if(dev_def.remote)
 321   1          {
 322   2              dev_def.dev_channel[2].remote_val = 0;
 323   2              RF_LED = 0;
 324   2          }
 325   1      }
 326          static void key4_long_press(void)
 327          {
 328   1          if(dev_def.remote)
 329   1          {
 330   2              dev_def.dev_channel[3].remote_val = 0;
 331   2              RF_LED = 0;
 332   2          }
 333   1      }
 334          static void key1_long_up_press(void)
 335          {
 336   1          if(!dev_def.remote)
 337   1          {
 338   2              h595_val |= KEY1_595;
 339   2              update_time = 10;
 340   2              dev_def.setting = true;
 341   2              SendTo595(h595_val);
 342   2          }
 343   1      }
 344          static void key2_long_up_press(void)
 345          {
 346   1          if(!dev_def.remote)
 347   1          {
 348   2              h595_val |= KEY2_595;
 349   2              update_time = 10;
 350   2              dev_def.setting = true;
 351   2              SendTo595(h595_val);
 352   2              }
 353   1      }
 354          static void key3_long_up_press(void)
 355          {
 356   1          if(!dev_def.remote)
 357   1          {
 358   2              h595_val |= KEY3_595;
 359   2              update_time = 10;
 360   2              dev_def.setting = true;
 361   2              SendTo595(h595_val);
 362   2              }
 363   1      }
C51 COMPILER V9.01   KEY                                                                   07/17/2017 20:56:10 PAGE 7   

 364          static void key4_long_up_press(void)
 365          {
 366   1          if(!dev_def.remote)
 367   1          {
 368   2              h595_val |= KEY4_595;
 369   2              update_time = 10;
 370   2              dev_def.setting = true;
 371   2              SendTo595(h595_val);
 372   2              }
 373   1      }
 374          static void key1_twice_press(void)
 375          {
 376   1          if(dev_def.dev_channel[0].channel_mode == DEV_JOGGING)
 377   1          {
 378   2              dev_def.dev_channel[0].channel_mode = DEV_SELFLOCK;
 379   2          }
 380   1          else
 381   1          {
 382   2              dev_def.dev_channel[0].channel_mode = DEV_JOGGING;
 383   2          }
 384   1          dev_def.dev_channel[0].update_flag = true; 
 385   1          dev_def.update_local_cnt = 0;
 386   1          save_mode_flag = true;
 387   1      }
 388          static void key2_twice_press(void)
 389          {
 390   1          if(dev_def.dev_channel[1].channel_mode == DEV_JOGGING)
 391   1          {
 392   2              dev_def.dev_channel[1].channel_mode = DEV_SELFLOCK;
 393   2          }
 394   1          else
 395   1          {
 396   2              dev_def.dev_channel[1].channel_mode = DEV_JOGGING;
 397   2          }
 398   1          dev_def.dev_channel[1].update_flag = true; 
 399   1          dev_def.update_local_cnt = 0;
 400   1          save_mode_flag = true;
 401   1      }
 402          static void key3_twice_press(void)
 403          {
 404   1          if(dev_def.dev_channel[2].channel_mode == DEV_JOGGING)
 405   1          {
 406   2              dev_def.dev_channel[2].channel_mode = DEV_SELFLOCK;
 407   2          }
 408   1          else
 409   1          {
 410   2              dev_def.dev_channel[2].channel_mode = DEV_JOGGING;
 411   2          }
 412   1          dev_def.dev_channel[2].update_flag = true; 
 413   1          dev_def.update_local_cnt = 0;
 414   1          save_mode_flag = true;
 415   1      }
 416          static void key4_twice_press(void)
 417          {
 418   1          if(dev_def.dev_channel[3].channel_mode == DEV_JOGGING)
 419   1          {
 420   2              dev_def.dev_channel[3].channel_mode = DEV_SELFLOCK;
 421   2          }
 422   1          else
 423   1          {
 424   2              dev_def.dev_channel[3].channel_mode = DEV_JOGGING;
 425   2          }
C51 COMPILER V9.01   KEY                                                                   07/17/2017 20:56:10 PAGE 8   

 426   1          dev_def.dev_channel[3].update_flag = true; 
 427   1          dev_def.update_local_cnt = 0;
 428   1          save_mode_flag = true;
 429   1      }
 430          static void key5_twice_press(void)
 431          {
 432   1          if(dev_def.lock == false)
 433   1          {
 434   2              dev_def.lock = true;
 435   2              MODE_LED = 1;
 436   2          }
 437   1          else
 438   1          {
 439   2              dev_def.lock = false;
 440   2              MODE_LED = 0;
 441   2          }
 442   1          h595_val &= 0x0f;
 443   1          SendTo595(h595_val);
 444   1          dev_def.dev_channel[0].update_flag = true;
 445   1          dev_def.dev_channel[1].update_flag = true;
 446   1          dev_def.dev_channel[2].update_flag = true;
 447   1          dev_def.dev_channel[3].update_flag = true;
 448   1          dev_def.update_local_cnt = 0;
 449   1          save_mode_flag = true;
 450   1      }
 451          static void registerKeys(void)
 452          {
 453   1          keyRegisterSingle(key1_is_press,key1_short_press,key1_short_up_press,key1_long_press,key1_long_up_pres
             -s,key1_twice_press);
 454   1          keyRegisterSingle(key2_is_press,key2_short_press,key2_short_up_press,key2_long_press,key2_long_up_pres
             -s,key2_twice_press);
 455   1          keyRegisterSingle(key3_is_press,key3_short_press,key3_short_up_press,key3_long_press,key3_long_up_pres
             -s,key3_twice_press);
 456   1          keyRegisterSingle(key4_is_press,key4_short_press,key4_short_up_press,key4_long_press,key4_long_up_pres
             -s,key4_twice_press);
 457   1          keyRegisterSingle(key5_is_press,NULL,key5_short_up_press,key5_long_press,NULL,key5_twice_press);
 458   1      }
 459          void keyInit(void)
 460          {
 461   1              P1M1 |= 0x1f;//初始化P10 -> P14为输入
 462   1              P1M2 &= 0Xe0;
 463   1              registerKeys();
 464   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1157    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
