C51 COMPILER V9.01   KEY                                                                   07/17/2017 16:18:52 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN key.obj
COMPILER INVOKED BY: F:\Program Files\Keil\C51\BIN\C51.EXE code\key\key.c BROWSE INCDIR(.\code\key;.\code\logic;.\code\t
                    -imer;.\code\driver;.\code\led;.\code\common;.\code\flash;.\code\remote) DEBUG OBJECTEXTEND PRINT(.\key.lst) OBJECT(key.o
                    -bj)

line level    source

   1          #include "key.h"
   2          #include "key_driver.h"
   3          #include "led.h"
   4          #include "logic.h"
   5          
   6          sbit KEY1 = P1^3;
   7          sbit KEY2 = P1^2;
   8          sbit KEY3 = P1^1;
   9          sbit KEY4 = P1^0;
  10          sbit KEY5 = P1^4;
  11          uint8_t h595_val = 0x0f;
  12          
  13          static bool key1_is_press(void)
  14          {
  15   1          if(0 == KEY1)
  16   1          {
  17   2              return true;
  18   2          }
  19   1          return false;
  20   1      }
  21          static bool key2_is_press(void)
  22          {
  23   1          if(0 == KEY2)
  24   1          {
  25   2              return true;
  26   2          }
  27   1          return false;
  28   1      }
  29          static bool key3_is_press(void)
  30          {
  31   1          if(0 == KEY3)
  32   1          {
  33   2              return true;
  34   2          }
  35   1          return false;
  36   1      }
  37          static bool key4_is_press(void)
  38          {
  39   1          if(0 == KEY4)
  40   1          {
  41   2              return true;
  42   2          }
  43   1          return false;
  44   1      }
  45          static bool key5_is_press(void)
  46          {
  47   1          if(0 == KEY5)
  48   1          {
  49   2              return true;
  50   2          }
  51   1          return false;
  52   1      }
  53          
C51 COMPILER V9.01   KEY                                                                   07/17/2017 16:18:52 PAGE 2   

  54          static void key1_short_press(void)
  55          {
  56   1          if(dev_def.remote)
  57   1          {
  58   2              dev_def.remote_channel = 1;
  59   2          }
  60   1          else
  61   1          {
  62   2              if(h595_val | KEY1_595)
  63   2              {
  64   3                  h595_val = h595_val & (~KEY1_595);
  65   3                  SendTo595(h595_val);
  66   3              }
  67   2          }
  68   1      }
  69          static void key2_short_press(void)
  70          {
  71   1          if(dev_def.remote)
  72   1          {
  73   2              dev_def.remote_channel = 2;
  74   2          }
  75   1          else
  76   1          {
  77   2              if(h595_val | KEY2_595)
  78   2              {
  79   3                  h595_val = h595_val & (~KEY2_595);
  80   3                      SendTo595(h595_val);    
  81   3              }
  82   2              }
  83   1      }
  84          static void key3_short_press(void)
  85          {   
  86   1          if(dev_def.remote)
  87   1          {
  88   2              dev_def.remote_channel = 3;
  89   2          }
  90   1          else
  91   1          {
  92   2              if(h595_val | KEY3_595)
  93   2              {
  94   3                      h595_val = h595_val & (~KEY3_595);
  95   3                      SendTo595(h595_val);
  96   3              }
  97   2              }
  98   1      }
  99          static void key4_short_press(void)
 100          {
 101   1          if(dev_def.remote)
 102   1          {
 103   2              dev_def.remote_channel = 4;
 104   2          }
 105   1          else
 106   1          {
 107   2              if(h595_val | KEY4_595)
 108   2              {
 109   3                      h595_val = h595_val & (~KEY4_595);
 110   3                      SendTo595(h595_val);
 111   3              }
 112   2              }
 113   1      }
 114          static void key5_short_up_press(void)
 115          {
C51 COMPILER V9.01   KEY                                                                   07/17/2017 16:18:52 PAGE 3   

 116   1          if(dev_def.remote)
 117   1          {
 118   2              dev_def.remote = false;
 119   2          }
 120   1      }
 121          
 122          static void key1_short_up_press(void)
 123          {
 124   1          if(!dev_def.remote)
 125   1          {
 126   2              if(RELAY1)
 127   2              {
 128   3                  h595_val &= (~RELAY1_595);
 129   3              }
 130   2              else
 131   2              {
 132   3                  if(dev_def.lock)
 133   3                  {
 134   4                      h595_val &= 0x0f;
 135   4                  }
 136   3                  h595_val |= RELAY1_595;
 137   3              }
 138   2              h595_val |= KEY1_595;
 139   2              SendTo595(h595_val);
 140   2              if(dev_def.setting == true)
 141   2              {
 142   3                  dev_def.setting = false;
 143   3                  update_time = 10;
 144   3              }
 145   2              else
 146   2              {
 147   3                  update_time = 5;
 148   3              }
 149   2              dev_def.dev_channel[0].update_flag = true;
 150   2              dev_def.dev_channel[1].update_flag = true;
 151   2              dev_def.dev_channel[2].update_flag = true;
 152   2              dev_def.dev_channel[3].update_flag = true;
 153   2              dev_def.update_local_cnt = 0;
 154   2          }
 155   1      }
 156          static void key2_short_up_press(void)
 157          {
 158   1          if(!dev_def.remote)
 159   1          {
 160   2              if(RELAY2)
 161   2              {
 162   3                  h595_val &= (~RELAY2_595);
 163   3              }
 164   2              else
 165   2              {
 166   3                  if(dev_def.lock)
 167   3                  {
 168   4                      h595_val &= 0x0f;
 169   4                  }
 170   3                  h595_val |= RELAY2_595; 
 171   3              }
 172   2              h595_val |= KEY2_595;
 173   2              SendTo595(h595_val);
 174   2              if(dev_def.setting == true)
 175   2              {
 176   3                  dev_def.setting = false;
 177   3                  update_time = 10;
C51 COMPILER V9.01   KEY                                                                   07/17/2017 16:18:52 PAGE 4   

 178   3              }
 179   2              else
 180   2              {
 181   3                  update_time = 5;
 182   3              }
 183   2              dev_def.dev_channel[0].update_flag = true;
 184   2              dev_def.dev_channel[1].update_flag = true;
 185   2              dev_def.dev_channel[2].update_flag = true;
 186   2              dev_def.dev_channel[3].update_flag = true;
 187   2              dev_def.update_local_cnt = 0;
 188   2          }
 189   1      }
 190          static void key3_short_up_press(void)
 191          {
 192   1          if(!dev_def.remote)
 193   1          {
 194   2              if(RELAY3)
 195   2              {
 196   3                  h595_val &= (~RELAY3_595);
 197   3              }
 198   2              else
 199   2              {
 200   3                  if(dev_def.lock)
 201   3                  {
 202   4                      h595_val &= 0x0f;
 203   4                  }
 204   3                  h595_val |= RELAY3_595;
 205   3                  
 206   3              }
 207   2              h595_val |= KEY3_595;
 208   2              SendTo595(h595_val);
 209   2              if(dev_def.setting == true)
 210   2              {
 211   3                  dev_def.setting = false;
 212   3                  update_time = 10;
 213   3              }
 214   2              else
 215   2              {
 216   3                  update_time = 5;
 217   3              }
 218   2              dev_def.dev_channel[0].update_flag = true;
 219   2              dev_def.dev_channel[1].update_flag = true;
 220   2              dev_def.dev_channel[2].update_flag = true;
 221   2              dev_def.dev_channel[3].update_flag = true;
 222   2              dev_def.update_local_cnt = 0;
 223   2          }
 224   1      }
 225          static void key4_short_up_press(void)
 226          {
 227   1          if(!dev_def.remote)
 228   1          {
 229   2              if(RELAY4)
 230   2              {
 231   3                  h595_val &= (~RELAY4_595);
 232   3                  
 233   3              }
 234   2              else
 235   2              {
 236   3                  if(dev_def.lock)
 237   3                  {
 238   4                      h595_val &= 0x0f;
 239   4                  }
C51 COMPILER V9.01   KEY                                                                   07/17/2017 16:18:52 PAGE 5   

 240   3                  h595_val |= RELAY4_595;
 241   3              }
 242   2              h595_val |= KEY4_595;
 243   2              SendTo595(h595_val);
 244   2              if(dev_def.setting == true)
 245   2              {
 246   3                  dev_def.setting = false;
 247   3                  update_time = 10;
 248   3              }
 249   2              else
 250   2              {
 251   3                  update_time = 5;
 252   3              }
 253   2              dev_def.dev_channel[0].update_flag = true;
 254   2              dev_def.dev_channel[1].update_flag = true;
 255   2              dev_def.dev_channel[2].update_flag = true;
 256   2              dev_def.dev_channel[3].update_flag = true;
 257   2              dev_def.update_local_cnt = 0;
 258   2          }
 259   1      }
 260          static void key5_long_press(void)
 261          {
 262   1          if(dev_def.remote)
 263   1          {
 264   2              dev_def.remote = false;
 265   2          }
 266   1          else
 267   1          {
 268   2              dev_def.remote = true;
 269   2              dev_def.remote_channel = 0;
 270   2          }
 271   1      }
 272          static void key1_long_up_press(void)
 273          {
 274   1          h595_val |= KEY1_595;
 275   1          update_time = 10;
 276   1          dev_def.setting = true;
 277   1          SendTo595(h595_val);
 278   1      }
 279          static void key2_long_up_press(void)
 280          {
 281   1              h595_val |= KEY2_595;
 282   1              update_time = 10;
 283   1              dev_def.setting = true;
 284   1              SendTo595(h595_val);
 285   1      }
 286          static void key3_long_up_press(void)
 287          {
 288   1              h595_val |= KEY3_595;
 289   1              update_time = 10;
 290   1              dev_def.setting = true;
 291   1              SendTo595(h595_val);
 292   1      }
 293          static void key4_long_up_press(void)
 294          {
 295   1              h595_val |= KEY4_595;
 296   1              update_time = 10;
 297   1              dev_def.setting = true;
 298   1              SendTo595(h595_val);
 299   1      }
 300          static void key1_twice_press(void)
 301          {
C51 COMPILER V9.01   KEY                                                                   07/17/2017 16:18:52 PAGE 6   

 302   1          if(dev_def.dev_channel[0].channel_mode == DEV_JOGGING)
 303   1          {
 304   2              dev_def.dev_channel[0].channel_mode = DEV_SELFLOCK;
 305   2          }
 306   1          else
 307   1          {
 308   2              dev_def.dev_channel[0].channel_mode = DEV_JOGGING;
 309   2          }
 310   1          dev_def.dev_channel[0].update_flag = true; 
 311   1          dev_def.update_local_cnt = 0;
 312   1          save_mode_flag = true;
 313   1      }
 314          static void key2_twice_press(void)
 315          {
 316   1          if(dev_def.dev_channel[1].channel_mode == DEV_JOGGING)
 317   1          {
 318   2              dev_def.dev_channel[1].channel_mode = DEV_SELFLOCK;
 319   2          }
 320   1          else
 321   1          {
 322   2              dev_def.dev_channel[1].channel_mode = DEV_JOGGING;
 323   2          }
 324   1          dev_def.dev_channel[1].update_flag = true; 
 325   1          dev_def.update_local_cnt = 0;
 326   1          save_mode_flag = true;
 327   1      }
 328          static void key3_twice_press(void)
 329          {
 330   1          if(dev_def.dev_channel[2].channel_mode == DEV_JOGGING)
 331   1          {
 332   2              dev_def.dev_channel[2].channel_mode = DEV_SELFLOCK;
 333   2          }
 334   1          else
 335   1          {
 336   2              dev_def.dev_channel[2].channel_mode = DEV_JOGGING;
 337   2          }
 338   1          dev_def.dev_channel[2].update_flag = true; 
 339   1          dev_def.update_local_cnt = 0;
 340   1          save_mode_flag = true;
 341   1      }
 342          static void key4_twice_press(void)
 343          {
 344   1          if(dev_def.dev_channel[3].channel_mode == DEV_JOGGING)
 345   1          {
 346   2              dev_def.dev_channel[3].channel_mode = DEV_SELFLOCK;
 347   2          }
 348   1          else
 349   1          {
 350   2              dev_def.dev_channel[3].channel_mode = DEV_JOGGING;
 351   2          }
 352   1          dev_def.dev_channel[3].update_flag = true; 
 353   1          dev_def.update_local_cnt = 0;
 354   1          save_mode_flag = true;
 355   1      }
 356          static void key5_twice_press(void)
 357          {
 358   1          if(dev_def.lock == false)
 359   1          {
 360   2              dev_def.lock = true;
 361   2              MODE_LED = 1;
 362   2          }
 363   1          else
C51 COMPILER V9.01   KEY                                                                   07/17/2017 16:18:52 PAGE 7   

 364   1          {
 365   2              dev_def.lock = false;
 366   2              MODE_LED = 0;
 367   2          }
 368   1          h595_val &= 0x0f;
 369   1          SendTo595(h595_val);
 370   1          dev_def.dev_channel[0].update_flag = true;
 371   1          dev_def.dev_channel[1].update_flag = true;
 372   1          dev_def.dev_channel[2].update_flag = true;
 373   1          dev_def.dev_channel[3].update_flag = true;
 374   1          dev_def.update_local_cnt = 0;
 375   1          save_mode_flag = true;
 376   1      }
 377          static void registerKeys(void)
 378          {
 379   1          keyRegisterSingle(key1_is_press,key1_short_press,key1_short_up_press,NULL,key1_long_up_press,key1_twic
             -e_press);
 380   1          keyRegisterSingle(key2_is_press,key2_short_press,key2_short_up_press,NULL,key2_long_up_press,key2_twic
             -e_press);
 381   1          keyRegisterSingle(key3_is_press,key3_short_press,key3_short_up_press,NULL,key3_long_up_press,key3_twic
             -e_press);
 382   1          keyRegisterSingle(key4_is_press,key4_short_press,key4_short_up_press,NULL,key4_long_up_press,key4_twic
             -e_press);
 383   1          keyRegisterSingle(key5_is_press,NULL,key5_short_up_press,key5_long_press,NULL,key5_twice_press);
 384   1      }
 385          void keyInit(void)
 386          {
 387   1              P1M1 |= 0x1f;//初始化P10 -> P14为输入
 388   1              P1M2 &= 0Xe0;
 389   1              registerKeys();
 390   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1016    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
