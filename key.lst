C51 COMPILER V9.01   KEY                                                                   07/13/2017 16:31:03 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN key.obj
COMPILER INVOKED BY: F:\Program Files\Keil\C51\BIN\C51.EXE code\key\key.c BROWSE INCDIR(.\code\key;.\code\logic;.\code\t
                    -imer;.\code\driver;.\code\led;.\code\common;.\code\flash;.\code\remote) DEBUG OBJECTEXTEND PRINT(.\key.lst) OBJECT(key.o
                    -bj)

line level    source

   1          #include "key.h"
   2          #include "key_driver.h"
   3          #include "led.h"
   4          #include "logic.h"
   5          
   6          sbit KEY1 = P1^3;
   7          sbit KEY2 = P1^2;
   8          sbit KEY3 = P1^1;
   9          sbit KEY4 = P1^0;
  10          sbit KEY5 = P1^4;
  11          uint8_t h595_val = 0x0f;
  12          
  13          static bool key1_is_press(void)
  14          {
  15   1          if(0 == KEY1)
  16   1          {
  17   2              return true;
  18   2          }
  19   1          return false;
  20   1      }
  21          static bool key2_is_press(void)
  22          {
  23   1          if(0 == KEY2)
  24   1          {
  25   2              return true;
  26   2          }
  27   1          return false;
  28   1      }
  29          static bool key3_is_press(void)
  30          {
  31   1          if(0 == KEY3)
  32   1          {
  33   2              return true;
  34   2          }
  35   1          return false;
  36   1      }
  37          static bool key4_is_press(void)
  38          {
  39   1          if(0 == KEY4)
  40   1          {
  41   2              return true;
  42   2          }
  43   1          return false;
  44   1      }
  45          static bool key5_is_press(void)
  46          {
  47   1          if(0 == KEY5)
  48   1          {
  49   2              return true;
  50   2          }
  51   1          return false;
  52   1      }
  53          
C51 COMPILER V9.01   KEY                                                                   07/13/2017 16:31:03 PAGE 2   

  54          static void key1_short_press(void)
  55          {
  56   1          if(h595_val | KEY1_595)
  57   1          {
  58   2              h595_val = h595_val & (~KEY1_595);
  59   2                  SendTo595(h595_val);
  60   2          }
  61   1      }
  62          static void key2_short_press(void)
  63          {
  64   1          if(h595_val | KEY2_595)
  65   1          {
  66   2              h595_val = h595_val & (~KEY2_595);
  67   2              SendTo595(h595_val);
  68   2              
  69   2              }
  70   1      }
  71          static void key3_short_press(void)
  72          {   
  73   1          if(h595_val | KEY3_595)
  74   1          {
  75   2              h595_val = h595_val & (~KEY3_595);
  76   2              SendTo595(h595_val);
  77   2              }
  78   1      }
  79          static void key4_short_press(void)
  80          {
  81   1          if(h595_val | KEY4_595)
  82   1          {
  83   2              h595_val = h595_val & (~KEY4_595);
  84   2              SendTo595(h595_val);
  85   2              }
  86   1      }
  87          static void key1_short_up_press(void)
  88          {
  89   1          if(RELAY1)
  90   1          {
  91   2              h595_val &= (~RELAY1_595);
  92   2          }
  93   1          else
  94   1          {
  95   2              if(dev_def.lock)
  96   2              {
  97   3                  h595_val &= 0x0f;
  98   3              }
  99   2              h595_val |= RELAY1_595;
 100   2          }
 101   1          h595_val |= KEY1_595;
 102   1          SendTo595(h595_val);
 103   1          if(dev_def.setting == true)
 104   1          {
 105   2              dev_def.setting = false;
 106   2              update_time = 10;
 107   2          }
 108   1          else
 109   1          {
 110   2              update_time = 5;
 111   2          }
 112   1          dev_def.dev_channel[0].update_flag = true;
 113   1          dev_def.dev_channel[1].update_flag = true;
 114   1          dev_def.dev_channel[2].update_flag = true;
 115   1          dev_def.dev_channel[3].update_flag = true;
C51 COMPILER V9.01   KEY                                                                   07/13/2017 16:31:03 PAGE 3   

 116   1          dev_def.update_local_cnt = 0;
 117   1      }
 118          static void key2_short_up_press(void)
 119          {
 120   1              if(RELAY2)
 121   1          {
 122   2              h595_val &= (~RELAY2_595);
 123   2          }
 124   1          else
 125   1          {
 126   2              if(dev_def.lock)
 127   2              {
 128   3                  h595_val &= 0x0f;
 129   3              }
 130   2              h595_val |= RELAY2_595; 
 131   2          }
 132   1          h595_val |= KEY2_595;
 133   1          SendTo595(h595_val);
 134   1          if(dev_def.setting == true)
 135   1          {
 136   2              dev_def.setting = false;
 137   2              update_time = 10;
 138   2          }
 139   1          else
 140   1          {
 141   2              update_time = 5;
 142   2          }
 143   1          dev_def.dev_channel[0].update_flag = true;
 144   1          dev_def.dev_channel[1].update_flag = true;
 145   1          dev_def.dev_channel[2].update_flag = true;
 146   1          dev_def.dev_channel[3].update_flag = true;
 147   1          dev_def.update_local_cnt = 0;
 148   1      }
 149          static void key3_short_up_press(void)
 150          {
 151   1              if(RELAY3)
 152   1          {
 153   2              h595_val &= (~RELAY3_595);
 154   2          }
 155   1          else
 156   1          {
 157   2              if(dev_def.lock)
 158   2              {
 159   3                  h595_val &= 0x0f;
 160   3              }
 161   2              h595_val |= RELAY3_595;
 162   2              
 163   2          }
 164   1          h595_val |= KEY3_595;
 165   1          SendTo595(h595_val);
 166   1          if(dev_def.setting == true)
 167   1          {
 168   2              dev_def.setting = false;
 169   2              update_time = 10;
 170   2          }
 171   1          else
 172   1          {
 173   2              update_time = 5;
 174   2          }
 175   1          dev_def.dev_channel[0].update_flag = true;
 176   1          dev_def.dev_channel[1].update_flag = true;
 177   1          dev_def.dev_channel[2].update_flag = true;
C51 COMPILER V9.01   KEY                                                                   07/13/2017 16:31:03 PAGE 4   

 178   1          dev_def.dev_channel[3].update_flag = true;
 179   1          dev_def.update_local_cnt = 0;
 180   1      }
 181          static void key4_short_up_press(void)
 182          {
 183   1              if(RELAY4)
 184   1          {
 185   2              h595_val &= (~RELAY4_595);
 186   2              
 187   2          }
 188   1          else
 189   1          {
 190   2              if(dev_def.lock)
 191   2              {
 192   3                  h595_val &= 0x0f;
 193   3              }
 194   2              h595_val |= RELAY4_595;
 195   2          }
 196   1          h595_val |= KEY4_595;
 197   1          SendTo595(h595_val);
 198   1          if(dev_def.setting == true)
 199   1          {
 200   2              dev_def.setting = false;
 201   2              update_time = 10;
 202   2          }
 203   1          else
 204   1          {
 205   2              update_time = 5;
 206   2          }
 207   1          dev_def.dev_channel[0].update_flag = true;
 208   1          dev_def.dev_channel[1].update_flag = true;
 209   1          dev_def.dev_channel[2].update_flag = true;
 210   1          dev_def.dev_channel[3].update_flag = true;
 211   1          dev_def.update_local_cnt = 0;
 212   1      }
 213          static void key1_long_up_press(void)
 214          {
 215   1          h595_val |= KEY1_595;
 216   1          update_time = 10;
 217   1          dev_def.setting = true;
 218   1          SendTo595(h595_val);
 219   1      }
 220          static void key2_long_up_press(void)
 221          {
 222   1              h595_val |= KEY2_595;
 223   1              update_time = 10;
 224   1              dev_def.setting = true;
 225   1              SendTo595(h595_val);
 226   1      }
 227          static void key3_long_up_press(void)
 228          {
 229   1              h595_val |= KEY3_595;
 230   1              update_time = 10;
 231   1              dev_def.setting = true;
 232   1              SendTo595(h595_val);
 233   1      }
 234          static void key4_long_up_press(void)
 235          {
 236   1              h595_val |= KEY4_595;
 237   1              update_time = 10;
 238   1              dev_def.setting = true;
 239   1              SendTo595(h595_val);
C51 COMPILER V9.01   KEY                                                                   07/13/2017 16:31:03 PAGE 5   

 240   1      }
 241          static void key1_twice_press(void)
 242          {
 243   1          if(dev_def.dev_channel[0].channel_mode == DEV_JOGGING)
 244   1          {
 245   2              dev_def.dev_channel[0].channel_mode = DEV_SELFLOCK;
 246   2          }
 247   1          else
 248   1          {
 249   2              dev_def.dev_channel[0].channel_mode = DEV_JOGGING;
 250   2          }
 251   1          dev_def.dev_channel[0].update_flag = true; 
 252   1          dev_def.update_local_cnt = 0;
 253   1          save_mode_flag = true;
 254   1      }
 255          static void key2_twice_press(void)
 256          {
 257   1          if(dev_def.dev_channel[1].channel_mode == DEV_JOGGING)
 258   1          {
 259   2              dev_def.dev_channel[1].channel_mode = DEV_SELFLOCK;
 260   2          }
 261   1          else
 262   1          {
 263   2              dev_def.dev_channel[1].channel_mode = DEV_JOGGING;
 264   2          }
 265   1          dev_def.dev_channel[1].update_flag = true; 
 266   1          dev_def.update_local_cnt = 0;
 267   1          save_mode_flag = true;
 268   1      }
 269          static void key3_twice_press(void)
 270          {
 271   1          if(dev_def.dev_channel[2].channel_mode == DEV_JOGGING)
 272   1          {
 273   2              dev_def.dev_channel[2].channel_mode = DEV_SELFLOCK;
 274   2          }
 275   1          else
 276   1          {
 277   2              dev_def.dev_channel[2].channel_mode = DEV_JOGGING;
 278   2          }
 279   1          dev_def.dev_channel[2].update_flag = true; 
 280   1          dev_def.update_local_cnt = 0;
 281   1          save_mode_flag = true;
 282   1      }
 283          static void key4_twice_press(void)
 284          {
 285   1          if(dev_def.dev_channel[3].channel_mode == DEV_JOGGING)
 286   1          {
 287   2              dev_def.dev_channel[3].channel_mode = DEV_SELFLOCK;
 288   2          }
 289   1          else
 290   1          {
 291   2              dev_def.dev_channel[3].channel_mode = DEV_JOGGING;
 292   2          }
 293   1          dev_def.dev_channel[3].update_flag = true; 
 294   1          dev_def.update_local_cnt = 0;
 295   1          save_mode_flag = true;
 296   1      }
 297          static void key5_twice_press(void)
 298          {
 299   1          if(dev_def.lock == false)
 300   1          {
 301   2              dev_def.lock = true;
C51 COMPILER V9.01   KEY                                                                   07/13/2017 16:31:03 PAGE 6   

 302   2              MODE_LED = 1;
 303   2          }
 304   1          else
 305   1          {
 306   2              dev_def.lock = false;
 307   2              MODE_LED = 0;
 308   2          }
 309   1          h595_val &= 0x0f;
 310   1          SendTo595(h595_val);
 311   1          dev_def.dev_channel[0].update_flag = true;
 312   1          dev_def.dev_channel[1].update_flag = true;
 313   1          dev_def.dev_channel[2].update_flag = true;
 314   1          dev_def.dev_channel[3].update_flag = true;
 315   1          dev_def.update_local_cnt = 0;
 316   1          save_mode_flag = true;
 317   1      }
 318          static void registerKeys(void)
 319          {
 320   1          keyRegisterSingle(key1_is_press,key1_short_press,key1_short_up_press,NULL,key1_long_up_press,key1_twic
             -e_press);
 321   1          keyRegisterSingle(key2_is_press,key2_short_press,key2_short_up_press,NULL,key2_long_up_press,key2_twic
             -e_press);
 322   1          keyRegisterSingle(key3_is_press,key3_short_press,key3_short_up_press,NULL,key3_long_up_press,key3_twic
             -e_press);
 323   1          keyRegisterSingle(key4_is_press,key4_short_press,key4_short_up_press,NULL,key4_long_up_press,key4_twic
             -e_press);
 324   1          keyRegisterSingle(key5_is_press,NULL,NULL,NULL,NULL,key5_twice_press);
 325   1      }
 326          void keyInit(void)
 327          {
 328   1              P1M1 |= 0x1f;//初始化P10 -> P14为输入
 329   1              P1M2 &= 0Xe0;
 330   1              registerKeys();
 331   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    910    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
