C51 COMPILER V9.01   KEY                                                                   07/03/2017 19:39:55 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN key.obj
COMPILER INVOKED BY: F:\Program Files\Keil\C51\BIN\C51.EXE code\key\key.c BROWSE INCDIR(.\code\key;.\code\logic;.\code\t
                    -imer;.\code\driver;.\code\led;.\code\common) DEBUG OBJECTEXTEND PRINT(.\key.lst) OBJECT(key.obj)

line level    source

   1          #include "key.h"
   2          #include "key_driver.h"
   3          #include "led.h"
   4          #include "logic.h"
   5          
   6          sbit KEY1 = P1^3;
   7          sbit KEY2 = P1^2;
   8          sbit KEY3 = P1^1;
   9          sbit KEY4 = P1^0;
  10          sbit KEY5 = P1^4;
  11          uint8_t h595_val = 0x0f;
  12          
  13          static bool key1_is_press(void)
  14          {
  15   1          if(0 == KEY1)
  16   1          {
  17   2              return true;
  18   2          }
  19   1          return false;
  20   1      }
  21          static bool key2_is_press(void)
  22          {
  23   1          if(0 == KEY2)
  24   1          {
  25   2              return true;
  26   2          }
  27   1          return false;
  28   1      }
  29          static bool key3_is_press(void)
  30          {
  31   1          if(0 == KEY3)
  32   1          {
  33   2              return true;
  34   2          }
  35   1          return false;
  36   1      }
  37          static bool key4_is_press(void)
  38          {
  39   1          if(0 == KEY4)
  40   1          {
  41   2              return true;
  42   2          }
  43   1          return false;
  44   1      }
  45          static bool key5_is_press(void)
  46          {
  47   1          if(0 == KEY5)
  48   1          {
  49   2              return true;
  50   2          }
  51   1          return false;
  52   1      }
  53          
  54          static void key1_short_press(void)
C51 COMPILER V9.01   KEY                                                                   07/03/2017 19:39:55 PAGE 2   

  55          {
  56   1          if(h595_val | KEY1_595)
  57   1          {
  58   2              h595_val = h595_val & (~KEY1_595);
  59   2                  SendTo595(h595_val);
  60   2          }
  61   1      }
  62          static void key2_short_press(void)
  63          {
  64   1          if(h595_val | KEY2_595)
  65   1          {
  66   2              h595_val = h595_val & (~KEY2_595);
  67   2              SendTo595(h595_val);
  68   2              
  69   2              }
  70   1      }
  71          static void key3_short_press(void)
  72          {   
  73   1          if(h595_val | KEY3_595)
  74   1          {
  75   2              h595_val = h595_val & (~KEY3_595);
  76   2              SendTo595(h595_val);
  77   2              }
  78   1      }
  79          static void key4_short_press(void)
  80          {
  81   1          if(h595_val | KEY4_595)
  82   1          {
  83   2              h595_val = h595_val & (~KEY4_595);
  84   2              SendTo595(h595_val);
  85   2              }
  86   1      }
  87          static void key5_short_press(void)
  88          {
  89   1          
  90   1      }
  91          static void key1_short_up_press(void)
  92          {
  93   1          if(RELAY1)
  94   1          {
  95   2              h595_val &= (~RELAY1_595);
  96   2          }
  97   1          else
  98   1          {
  99   2              if(dev_def.lock)
 100   2              {
 101   3                  h595_val &= 0x0f;
 102   3              }
 103   2              h595_val |= RELAY1_595;
 104   2          }
 105   1          h595_val |= KEY1_595;
 106   1          SendTo595(h595_val);
 107   1          if(dev_def.setting == true)
 108   1          {
 109   2              dev_def.setting = false;
 110   2          }
 111   1          else
 112   1          {
 113   2              update_time = 10;
 114   2          }
 115   1          dev_def.dev_channel[0].update_flag = true;
 116   1          dev_def.dev_channel[1].update_flag = true;
C51 COMPILER V9.01   KEY                                                                   07/03/2017 19:39:55 PAGE 3   

 117   1          dev_def.dev_channel[2].update_flag = true;
 118   1          dev_def.dev_channel[3].update_flag = true;
 119   1          dev_def.update_local_cnt = 0;
 120   1      }
 121          static void key2_short_up_press(void)
 122          {
 123   1              if(RELAY2)
 124   1          {
 125   2              h595_val &= (~RELAY2_595);
 126   2          }
 127   1          else
 128   1          {
 129   2              if(dev_def.lock)
 130   2              {
 131   3                  h595_val &= 0x0f;
 132   3              }
 133   2              h595_val |= RELAY2_595; 
 134   2          }
 135   1          h595_val |= KEY2_595;
 136   1          SendTo595(h595_val);
 137   1          if(dev_def.setting == true)
 138   1          {
 139   2              dev_def.setting = false;
 140   2          }
 141   1          else
 142   1          {
 143   2              update_time = 10;
 144   2          }
 145   1          dev_def.dev_channel[0].update_flag = true;
 146   1          dev_def.dev_channel[1].update_flag = true;
 147   1          dev_def.dev_channel[2].update_flag = true;
 148   1          dev_def.dev_channel[3].update_flag = true;
 149   1          dev_def.update_local_cnt = 0;
 150   1      }
 151          static void key3_short_up_press(void)
 152          {
 153   1              if(RELAY3)
 154   1          {
 155   2              h595_val &= (~RELAY3_595);
 156   2          }
 157   1          else
 158   1          {
 159   2              if(dev_def.lock)
 160   2              {
 161   3                  h595_val &= 0x0f;
 162   3              }
 163   2              h595_val |= RELAY3_595;
 164   2              
 165   2          }
 166   1          h595_val |= KEY3_595;
 167   1          SendTo595(h595_val);
 168   1          if(dev_def.setting == true)
 169   1          {
 170   2              dev_def.setting = false;
 171   2          }
 172   1          else
 173   1          {
 174   2              update_time = 10;
 175   2          }
 176   1          dev_def.dev_channel[0].update_flag = true;
 177   1          dev_def.dev_channel[1].update_flag = true;
 178   1          dev_def.dev_channel[2].update_flag = true;
C51 COMPILER V9.01   KEY                                                                   07/03/2017 19:39:55 PAGE 4   

 179   1          dev_def.dev_channel[3].update_flag = true;
 180   1          dev_def.update_local_cnt = 0;
 181   1      }
 182          static void key4_short_up_press(void)
 183          {
 184   1              if(RELAY4)
 185   1          {
 186   2              h595_val &= (~RELAY4_595);
 187   2              
 188   2          }
 189   1          else
 190   1          {
 191   2              if(dev_def.lock)
 192   2              {
 193   3                  h595_val &= 0x0f;
 194   3              }
 195   2              h595_val |= RELAY4_595;
 196   2          }
 197   1          h595_val |= KEY4_595;
 198   1          SendTo595(h595_val);
 199   1          if(dev_def.setting == true)
 200   1          {
 201   2              dev_def.setting = false;
 202   2          }
 203   1          else
 204   1          {
 205   2              update_time = 10;
 206   2          }
 207   1          dev_def.dev_channel[0].update_flag = true;
 208   1          dev_def.dev_channel[1].update_flag = true;
 209   1          dev_def.dev_channel[2].update_flag = true;
 210   1          dev_def.dev_channel[3].update_flag = true;
 211   1          dev_def.update_local_cnt = 0;
 212   1      }
 213          static void key1_long_up_press(void)
 214          {
 215   1          h595_val |= KEY1_595;
 216   1          update_time = 10;
 217   1          dev_def.setting = true;
 218   1          SendTo595(h595_val);
 219   1      }
 220          static void key2_long_up_press(void)
 221          {
 222   1              h595_val |= KEY2_595;
 223   1              update_time = 10;
 224   1              dev_def.setting = true;
 225   1              SendTo595(h595_val);
 226   1      }
 227          static void key3_long_up_press(void)
 228          {
 229   1              h595_val |= KEY3_595;
 230   1              update_time = 10;
 231   1              dev_def.setting = true;
 232   1              SendTo595(h595_val);
 233   1      }
 234          static void key4_long_up_press(void)
 235          {
 236   1              h595_val |= KEY4_595;
 237   1              update_time = 10;
 238   1              dev_def.setting = true;
 239   1              SendTo595(h595_val);
 240   1      }
C51 COMPILER V9.01   KEY                                                                   07/03/2017 19:39:55 PAGE 5   

 241          static void key1_twice_press(void)
 242          {
 243   1          if(dev_def.dev_channel[0].channel_mode == DEV_JOGGING)
 244   1          {
 245   2              dev_def.dev_channel[0].channel_mode = DEV_SELFLOCK;
 246   2          }
 247   1          else
 248   1          {
 249   2              dev_def.dev_channel[0].channel_mode = DEV_JOGGING;
 250   2          }
 251   1          dev_def.dev_channel[0].update_flag = true; 
 252   1          dev_def.update_local_cnt = 0;
 253   1      }
 254          static void key2_twice_press(void)
 255          {
 256   1          if(dev_def.dev_channel[1].channel_mode == DEV_JOGGING)
 257   1          {
 258   2              dev_def.dev_channel[1].channel_mode = DEV_SELFLOCK;
 259   2          }
 260   1          else
 261   1          {
 262   2              dev_def.dev_channel[1].channel_mode = DEV_JOGGING;
 263   2          }
 264   1          dev_def.dev_channel[1].update_flag = true; 
 265   1          dev_def.update_local_cnt = 0;
 266   1      }
 267          static void key3_twice_press(void)
 268          {
 269   1          if(dev_def.dev_channel[2].channel_mode == DEV_JOGGING)
 270   1          {
 271   2              dev_def.dev_channel[2].channel_mode = DEV_SELFLOCK;
 272   2          }
 273   1          else
 274   1          {
 275   2              dev_def.dev_channel[2].channel_mode = DEV_JOGGING;
 276   2          }
 277   1          dev_def.dev_channel[2].update_flag = true; 
 278   1          dev_def.update_local_cnt = 0;
 279   1      }
 280          static void key4_twice_press(void)
 281          {
 282   1          if(dev_def.dev_channel[3].channel_mode == DEV_JOGGING)
 283   1          {
 284   2              dev_def.dev_channel[3].channel_mode = DEV_SELFLOCK;
 285   2          }
 286   1          else
 287   1          {
 288   2              dev_def.dev_channel[3].channel_mode = DEV_JOGGING;
 289   2          }
 290   1          dev_def.dev_channel[3].update_flag = true; 
 291   1          dev_def.update_local_cnt = 0;
 292   1      }
 293          static void registerKeys(void)
 294          {
 295   1          keyRegisterSingle(key1_is_press,key1_short_press,key1_short_up_press,NULL,key1_long_up_press,key1_twic
             -e_press);
 296   1          keyRegisterSingle(key2_is_press,key2_short_press,key2_short_up_press,NULL,key2_long_up_press,key2_twic
             -e_press);
 297   1          keyRegisterSingle(key3_is_press,key3_short_press,key3_short_up_press,NULL,key3_long_up_press,key3_twic
             -e_press);
 298   1          keyRegisterSingle(key4_is_press,key4_short_press,key4_short_up_press,NULL,key4_long_up_press,key4_twic
             -e_press);
C51 COMPILER V9.01   KEY                                                                   07/03/2017 19:39:55 PAGE 6   

 299   1          keyRegisterSingle(key5_is_press,key5_short_press,NULL,NULL,NULL,NULL);
 300   1      }
 301          void keyInit(void)
 302          {
 303   1              P1M1 |= 0x1f;//初始化P10 -> P14为输入
 304   1              P1M2 &= 0Xe0;
 305   1              registerKeys();
 306   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    833    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
